## Network > Flow Log > コンソール使用ガイド

## フローログ管理
### フローログの作成
NHN Cloudのコンソールでフローログ作成画面からフローログを作成できます。フローログが正しく動作するためには、フローログシステムがストレージへのアクセス権を持っている必要があります。詳細は、下部の**フローログのストレージアクセス権限付与**を参照してください。


**フローログ作成**ボタンをクリックすると、フローログの基本情報を設定できます。設定に必要な項目は次のとおりです。


* 名前：フローログの名前を入力します。
* 説明：フローログの説明を記述します。
* 収集対象：フローログの収集単位を選択できます。`VPC`, `Subnet`, `ネットワークインターフェイス`単位で作成できます。ここでマイプロジェクトに存在するVPC, Subnetネットワークインターフェイスリストを確認し、収集単位を選択できます。
* 収集トラフィックタイプ：**許可**、**ブロック**、または許可とブロックを同時に選択できます。許可を選択すると、**Security Groups**に許可されたパケットのみを収集し、**ブロック**をクリックすると、ブロックされたパケットのみを収集します。両方を選択すると、許可/ブロックされたパケットをすべて収集して集計します。

* 接続試行パケットのみ収集:この設定をチェックすると、接続が確立された後のパケットは収集しません。TCPの場合はTCP stateが確立されたパケットを、UDP/ICMPの場合はresponseパケットを収集しません。
* 収集間隔：収集されたパケットを整理し、統計を出してストレージにファイルを作成する時間周期です。1分から15分の間で設定が可能です。
* 収集項目：収集したい項目を選択します。基本項目を選択すると、収集データに対して必須項目のみを集計してファイルに記録します。ユーザー定義項目ではより多くの項目を選択できます。サポートする項目は[Flow Log概要](/Network/Flow%20Log/ko/overview/)の統計提供情報項目フィールドをご確認ください。

* ファイル保存パス：現在はObject Storageのみをサポートしています。**Object Storage**の場合は、OBS endpoint、AUTH_tenant、container、pathを一度に入力します。
    * {OBS_https_endpoint}/{AUTH_OBS_TENANT}/{Container}/{Path}
    * 例えば、OBS https endpointが`https://kr1-api-object-storage.nhncloudservice.com/v1`, AUTH_OBS_TENANTが`AUTH_e670167936434f85a03694184000ffe6`, Container名が`flowlog_container`、希望する保存パスが`example/my/folder`の場合、ファイル保存パスは次のとおりです。

    * ファイル保存パスの例：https://kr1-api-object-storage.nhncloudservice.com/v1/AUTH_e670167936434f85a03694184000ffe6/flowlog_container/example/my/folder


> [注意] Object Storageにユーザーが指定したコンテナが存在しないか、権限が正しく設定されていない場合、フローログはエラー状態になります。エラーの原因は、フローログ表示画面でステータスにマウスを乗せると確認できます。

 
> [参考] Object Storage内にユーザーが指定したパスが存在しない場合は、新規に作成します。


* ファイル分割保存:フローログが作成したファイルを分類するフォルダ周期です。 **1時間ごと**に指定すると、フローログはユーザーが設定したファイル保存パスの下に1時間単位で1つのフォルダに記録します。**1日ごと**を指定すると、1日単位でフォルダを作成します。**ユーザー定義パス**を選択すると、フォルダパスを直接作成できます。

    * {storage_url}/#{YEAR}/#{MONTH}/#{DAY}/#{HOUR}
    * 例：1時間ごとに設定した場合、 example/my/folder/2024/09/01/22フォルダの下に22時00分～22時59分に該当するフローログファイルを保存
    * 例：1日ごとに設定した場合、 example/my/folder/2024/09/01フォルダの下に9月1日のフローログファイルを保存
    * 例：ユーザー定義パスに設定した場合、好きな形式を直接作成できます。テンプレート変数として#{year}, #{month}, #{day}, #{hour}を使用できます。 <br> e.g.)ユーザー定義パスを`YEAR=#{year}/MONTH=#{month}/DAY=#{day}`で作成した場合、 example/my/folder/YEAR=2024/MONTH=09/DAY=01フォルダの下に2024年9月1日のフローログファイルを保存
    
    

* ファイル形式：ストレージに保存するファイルの形式です。**CSV**, **PARQUET** ファイル形式をサポートします。PARQUET`を使用すると、大きなファイルを小さなサイズに圧縮できます。

* ファイル圧縮：ストレージに保管する際にgzip形式で圧縮して保存するかどうか選択できます。

* ファイル名:フローログが作成したファイルを保存する時、ファイル名の形式を定義します。**基本ファイル名**を選択すると、 `#{logger_id}_#{year}-#{month}-#{day}T#{hour}:#{minute}:#{second}`の形式でファイルを作成します。 **ユーザー定義ファイル名**を指定すると、テンプレート変数を活用してファイルの名前を直接作成できます。

   * **ユーザー定義ファイル名**で提供するテンプレート変数は #{logger_id}, #{year}, #{month}, #{day}, #{hour}, #{minute}, #{second}です。この全てのテンプレート変数はそれぞれ1回ずつ使用しなければなりません。



### フローログの変更
**フローログ変更**ボタンをクリックして、フローログの名前と説明を変更できます。

### フローログの削除
**フローログ削除**ボタンをクリックして、フローログを削除できます。

> [注意]フローログが収集中のネットワークインターフェイスが削除されても、フローログは削除されません。代わりに、**削除されたリソース**というフレーズが表示され、フローログはユーザーが直接削除する必要があります。
> 収集対象リソースが削除された場合は、収集されるデータが存在しないため、課金はされません。

### フローログシステムアカウント情報
**フローログシステムアカウント情報**をクリックすると、フローログシステムが使用する**Flow LogテナントID**と**Flow Log APIユーザーID**が表示されます。フローログを使用するためには、ユーザーのストレージに該当Flow LogテナントID及びFlow Log APIユーザーIDに書き込みアクセス権限を付与する必要があります。詳細は下記の**フローログのストレージへのアクセス権限付与**を参照してください。




## フローログのストレージへのアクセス権限付与
### Object Storage
ストレージタイプをOBS(object storage)に指定してフローログを作成した場合、フローログシステムアカウントが該当OBSに書き込みでアクセスできる必要があります。もし、書き込み権限を正しく付与していない場合、フローログシステムアカウントはユーザーのOBSにデータを記録できません。


### 設定方法

* NHN Cloud > Object Storageコンソールにアクセスします。

* フローログデータを保存するコンテナを選択します。
* 下部の**基本情報 > アクセスポリシー設定変更**をクリックします。

* **ロールベースアクセスポリシー**で**使用**をクリックします。
* 上記で確認した**フローログシステムアカウント情報**のテナントIDとAPIユーザーIDを入力し、**Write**権限を付与します。

> [参考]フローログが作成された場合、最初に1回、ユーザーのOBSストレージに0Bytesファイル(ダミーファイル)を送信します。これにより、アクセス権限が正しく設定されたかどうかを検証します。このダミーファイルは短時間で削除されます。
> [参考] Object Storageに保存されるファイルの行数が20,000行を超えると、分割して保存されます。
> 20,000行以下:単一ファイルで保存 
> 20,000行超過: _part1、_part2などのサフィックスが付いた複数のファイルに分割保存
