## Network > Flow Log > 콘솔 사용 가이드

## 플로우 로그 관리
### 플로우 로그 생성
NHN Cloud 콘솔에서 플로우 로그 생성 화면을 통해 생성할 수 있습니다. 플로우 로그가 올바르게 동작하려면 플로우 로그 시스템이 저장소에 접근 권한을 가지고 있어야 합니다. 자세한 내용은 하단의 **플로우 로그의 저장소 접근 권한 부여**를 참고하세요.


**플로우 로그 생성** 버튼을 클릭하면 플로우 로그에 대한 기본 정보를 설정할 수 있습니다. 설정에 필요한 항목은 다음과 같습니다.


* 이름: 플로우 로그의 이름을 입력합니다.
* 설명: 플로우 로그에 대한 설명을 기술합니다.
* 수집 대상: 플로우 로그 수집 단위를 선택할 수 있습니다. `VPC`, `Subnet`, `네트워크 인터페이스` 단위로 생성할 수 있습니다. 이곳에서 내 프로젝트에 존재하는 VPC, Subnet 네트워크 인터페이스 목록을 확인할 수 있으며, 원하는 수집 단위를 선택할 수 있습니다.
* 수집 트래픽 유형: **허용**, **차단**, 또는 허용과 차단을 동시에 선택할 수 있습니다. 허용을 선택하면 **Security Groups**에 허용된 패킷만 수집하며, 차단을 클릭하면 차단된 패킷만 수집합니다. 둘 다 선택하면 허용/차단 패킷을 모두 수집하여 집계합니다.

* 연결 시도 패킷만 수집: 해당 설정을 체크하면 연결이 수립된 이후의 패킷은 수집하지 않습니다. TCP의 경우 TCP state가 established인 패킷을, UDP/ICMP의 경우에는 response 패킷을 수집하지 않습니다.
* 수집 간격: 수집된 패킷들을 정리하고 통계를 내어 저장소에 파일을 생성할 시간 주기입니다. 1분에서 15분 사이로 설정이 가능합니다.
* 수집 항목: 수집하고 싶은 항목을 선택합니다. 기본 항목을 선택하면 수집 데이터들에 대하여 필수 항목만 집계하여 파일에 기록합니다. 사용자 정의 항목에서는 더 많은 항목들을 선택할 수 있습니다. 지원하는 항목은 [Flow Log 개요](/Network/Flow%20Log/ko/overview/)의 통계 제공 정보 항목 필드를 확인하세요.

* 파일 저장 경로: 현재는 Object Storage만 지원합니다. **Object Storage**의 경우에는 OBS endpoint, AUTH_tenant, container, path를 한 번에 입력합니다.
    * {OBS_https_endpoint}/{AUTH_OBS_TENANT}/{Container}/{Path}
    * 예를 들어 OBS https endpoint가 `https://kr1-api-object-storage.nhncloudservice.com/v1`, AUTH_OBS_TENANT가 `AUTH_e670167936434f85a03694184000ffe6`, Container 이름이 `flowlog_container`, 희망하는 저장 경로가 `example/my/folder`인 경우, 파일 저장 경로는 다음과 같습니다.

    * 파일 저장 경로 예시: https://kr1-api-object-storage.nhncloudservice.com/v1/AUTH_e670167936434f85a03694184000ffe6/flowlog_container/example/my/folder


> [주의] Object Storage에 사용자가 지정한 container가 존재하지 않거나 권한이 올바르게 설정되어 있지 않으면 플로우 로그는 오류 상태로 전환됩니다. 오류 원인은 플로우 로그 보기 화면에서 상태에 마우스를 올리면 확인할 수 있습니다.

 
> [참고] Object Storage 내에 사용자가 지정한 경로가 존재하지 않으면 새로 생성합니다.


* 파일 분할 저장: 플로우 로그가 생성한 파일을 분류할 폴더 주기입니다. **1시간 마다**로 지정하면 플로우 로그는 사용자가 설정한 파일 저장 경로 아래에 1시간 단위로 하나의 폴더에 기록합니다. **1일 마다**로 지정하면 1일 단위로 폴더를 생성합니다. **사용자 정의 경로**를 선택하면 폴더 경로를 직접 작성할 수 있습니다.

    * {storage_url}/#{YEAR}/#{MONTH}/#{DAY}/#{HOUR}
    * 예: 1시간 마다로 설정 시, example/my/folder/2024/09/01/22 폴더 하위에 22시 00분~22시 59분에 해당하는 플로우 로그 파일들을 저장
    * 예: 1일 마다로 설정 시, example/my/folder/2024/09/01 폴더 하위에 9월 1일의 플로우 로그 파일들을 저장
    * 예: 사용자 정의 경로로 설정 시, 원하는 포맷을 직접 작성할 수 있습니다. 템플릿 변수로서 #{year}, #{month}, #{day}, #{hour}를 사용할 수 있습니다. <br> e.g.) 사용자 정의 경로를 `YEAR=#{year}/MONTH=#{month}/DAY=#{day}`로 생성 시, example/my/folder/YEAR=2024/MONTH=09/DAY=01 폴더 하위에 2024년 9월 1일의 플로우 로그 파일들을 저장


* 파일 형식: 저장소에 저장할 파일의 형식입니다. **CSV**, **PARQUET** 파일 형식을 지원합니다. `PARQUET`를 사용하면 큰 파일을 작은 사이즈로 압축할 수 있습니다.

* 파일 압축: 저장소에 보관할 때 gzip 형태로 압축하여 저장할지 선택할 수 있습니다.

* 파일명: 플로우 로그가 생성한 파일을 저장할 때, 파일 이름 형식을 정의합니다. **기본 파일명**을 선택하면 `#{logger_id}_#{year}-#{month}-#{day}T#{hour}:#{minute}:#{second}`의 형식으로 파일을 생성합니다. **사용자 정의 파일명**을 지정하면 템플릿 변수를 활용하여 파일의 이름을 직접 작성할 수 있습니다.

   * **사용자 정의 파일명**에서 제공하는 템플릿 변수는 #{logger_id}, #{year}, #{month}, #{day}, #{hour}, #{minute}, #{second}입니다. 이 모든 템플릿 변수들은 각각 1회씩만 사용 가능합니다.



### 플로우 로그 변경
**플로우 로그 변경** 버튼을 클릭하여 플로우 로그의 이름과 설명을 수정할 수 있습니다.

### 플로우 로그 삭제
**플로우 로그 삭제** 버튼을 클릭하여 플로우 로그를 삭제할 수 있습니다.

> [주의] 플로우 로그가 수집 중인 네트워크 인터페이스가 삭제되어도 플로우 로그는 삭제되지 않습니다. 대신, **삭제된 리소스** 라는 문구가 노출되며 플로우 로그는 사용자가 직접 삭제해야 합니다. 
> 수집 대상 리소스가 삭제된 경우에는 수집되는 데이터가 존재하지 않으므로 과금은 되지 않습니다.

### 플로우 로그 시스템 계정 정보
**플로우 로그 시스템 계정 정보**를 클릭하면 플로우 로그 시스템이 사용하는 **Flow Log 테넌트 ID**와 **Flow Log API 사용자 ID**가 표시됩니다. 플로우 로그를 사용하기 위해서는 사용자의 저장소에 해당 Flow Log 테넌트 ID 및 Flow Log API 사용자 ID에게 쓰기 접근 권한을 부여해야 합니다. 자세한 내용은 아래의 **플로우 로그의 저장소 접근 권한 부여**를 참고하세요.




## 플로우 로그의 저장소 접근 권한 부여
### Object Storage
저장소 타입을 OBS(object storage)로 지정하여 플로우 로그를 생성한 경우, 플로우 로그 시스템 계정이 해당 OBS에 쓰기로 접근할 수 있어야 합니다. 만약 쓰기 권한을 올바르게 부여하지 않았다면, 플로우 로그 시스템 계정은 사용자의 OBS에 데이터를 기록할 수 없습니다.


### 설정 방법

* NHN Cloud > Object Storage 콘솔로 접근합니다.

* 플로우 로그 데이터를 저장할 컨테이너를 선택합니다.
* 하단의 **기본 정보 > 접근 정책 설정 변경**을 클릭합니다.

* **역할 기반 접근 정책**에서 **사용**을 클릭합니다.
* 위에서 확인했던 **플로우 로그 시스템 계정 정보**의 테넌트 ID와 API 사용자 ID를 입력하고 **Write** 권한을 부여합니다.

> [참고] 플로우 로그가 생성된 경우, 최초 1회 사용자의 OBS 저장소로 0Bytes 파일(더미 파일)을 전송합니다. 이를 통해서 접근 권한이 올바르게 설정되었는지 검증합니다. 해당 더미 파일은 짧은 시간 내에 삭제됩니다.
> [참고] Object Storage에 저장되는 파일의 줄 수가 20,000줄을 초과하면 분할되어 저장됩니다. 
> 20,000줄 이하: 단일 파일로 저장 
> 20,000줄 초과: _part1, _part2 등의 접미사가 붙은 다수의 파일로 분할 저장

